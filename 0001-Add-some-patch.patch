From 4ffb2199928c114a6eac25450a069bda0c32d94e Mon Sep 17 00:00:00 2001
From: Zheng Junjie <z572@z572.online>
Date: Sat, 22 Mar 2025 21:54:13 +0800
Subject: [PATCH] Add some patch.

---
 debian/patches/0001-no-mtune-generic.patch | 25 ++++++++++++++
 debian/patches/0002-Remove-use-xsimd.patch | 39 ++++++++++++++++++++++
 debian/patches/series                      |  2 ++
 3 files changed, 66 insertions(+)
 create mode 100644 debian/patches/0001-no-mtune-generic.patch
 create mode 100644 debian/patches/0002-Remove-use-xsimd.patch
 create mode 100644 debian/patches/series

diff --git a/debian/patches/0001-no-mtune-generic.patch b/debian/patches/0001-no-mtune-generic.patch
new file mode 100644
index 000000000..4724b2713
--- /dev/null
+++ b/debian/patches/0001-no-mtune-generic.patch
@@ -0,0 +1,25 @@
+From aa35f2b6638f6ea4f54f3624cf4ca1cd2a71adf4 Mon Sep 17 00:00:00 2001
+From: Zheng Junjie <zhengjunjie@iscas.ac.cn>
+Date: Mon, 4 Nov 2024 12:53:29 +0800
+Subject: [PATCH] no -mtune=generic
+
+---
+ CMakeLists.txt | 2 +-
+ 1 file changed, 1 insertion(+), 1 deletion(-)
+
+diff --git a/CMakeLists.txt b/CMakeLists.txt
+index 3ca6735e4..da372993c 100644
+--- a/CMakeLists.txt
++++ b/CMakeLists.txt
+@@ -65,7 +65,7 @@ if(COMPILER_SUPPORTS_FMA)
+ endif()
+ 
+ # If building one the same hardware to be deployed on, try `-march=native`!
+-add_compile_options(-O3 -finline-limit=10000000 -ffp-contract=fast -ffast-math -mtune=generic)
++add_compile_options(-O3 -finline-limit=10000000 -ffp-contract=fast -ffast-math)
+ 
+ add_library(mppi_controller SHARED
+   src/controller.cpp
+-- 
+2.46.0
+
diff --git a/debian/patches/0002-Remove-use-xsimd.patch b/debian/patches/0002-Remove-use-xsimd.patch
new file mode 100644
index 000000000..c456afaf1
--- /dev/null
+++ b/debian/patches/0002-Remove-use-xsimd.patch
@@ -0,0 +1,39 @@
+From 73101833e8c03f134635f107d6f0a76386506399 Mon Sep 17 00:00:00 2001
+From: Zheng Junjie <z572@z572.online>
+Date: Sat, 22 Mar 2025 12:23:57 +0800
+Subject: [PATCH] Remove use xsimd.
+
+---
+ CMakeLists.txt | 6 +++---
+ 1 file changed, 3 insertions(+), 3 deletions(-)
+
+diff --git a/CMakeLists.txt b/CMakeLists.txt
+index 3ca6735e4..3fcbfe631 100644
+--- a/CMakeLists.txt
++++ b/CMakeLists.txt
+@@ -2,11 +2,11 @@ cmake_minimum_required(VERSION 3.5)
+ project(nav2_mppi_controller)
+ 
+ add_definitions(-DXTENSOR_ENABLE_XSIMD)
+-add_definitions(-DXTENSOR_USE_XSIMD)
++# add_definitions(-DXTENSOR_USE_XSIMD)
+ 
+ set(XTENSOR_USE_TBB 0)
+ set(XTENSOR_USE_OPENMP 0)
+-set(XTENSOR_USE_XSIMD 1)
++# set(XTENSOR_USE_XSIMD 1)
+ 
+ # set(XTENSOR_DEFAULT_LAYOUT column_major)  # row_major, column_major
+ # set(XTENSOR_DEFAULT_TRAVERSAL row_major)  # row_major, column_major
+@@ -97,7 +97,7 @@ set(libraries mppi_controller mppi_critics)
+ foreach(lib IN LISTS libraries)
+   target_compile_options(${lib} PUBLIC -fconcepts)
+   target_include_directories(${lib} PUBLIC ${xsimd_INCLUDE_DIRS})  #  ${OpenMP_INCLUDE_DIRS}
+-  target_link_libraries(${lib} xtensor xtensor::optimize xtensor::use_xsimd)
++  target_link_libraries(${lib} xtensor xtensor::optimize)
+   ament_target_dependencies(${lib} ${dependencies_pkgs})
+ endforeach()
+ 
+-- 
+2.47.1
+
diff --git a/debian/patches/series b/debian/patches/series
new file mode 100644
index 000000000..04ec82ca2
--- /dev/null
+++ b/debian/patches/series
@@ -0,0 +1,2 @@
+0001-no-mtune-generic.patch
+0002-Remove-use-xsimd.patch
-- 
2.41.0

